Overview
========

This sample demonstrates how to connect from Application Container Cloud Service
(ACCS) to the Exadata Express Cloud Service (EECS) using JDBC.

Prerequisites
-------------

You will need:

* An Exadata Express Cloud Service account
* A valid database user id and password for the EECS database
* An OPC account with ACCS

Setup
=====

Obtaining Required Jars
-----------------------

Connecting to EECS from Java requires you to use a number of updated or
patched jars.  Follow the instructions on this [OTN Page](http://www.oracle.com/technetwork/database/application-development/jdbc-eecloud-3089380.html)
to obtain the necessary files:

1.  Download [JCE Unlimited Strength Jurisdiction Policy Jars](http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html)

  * Create folder `<EXAMPLE_ROOT>/policy_jars`
  * Unzip the downloaded zip file and put **local_policy.jar** and
    **US_export_policy.jar** in `<EXAMPLE_ROOT>/policy_jars`

2.  Download [Patched 12.1.0.2 JDBC Thin driver (ojdbc7.jar) and 12.1.0.2 UCP (ucp.jar)](http://www.oracle.com/technetwork/database/application-development/jdbc/jdbc-ucp-cloud-3179120.html)

  * Create folder `<EXAMPLE_ROOT>/lib`
  * Put the downloaded **ojdbc7.jar** and **ucp.jar** into `<EXAMPLE_ROOT>/lib`

Obtaining EECS Client Credentials (JKS files)
---------------------------------------------

To connect to EECS, you will need to **download client credentials** by logging into
the service console and following the instructions on this [OTN Page](http://www.oracle.com/technetwork/database/application-development/jdbc-eecloud-3089380.html).
You'll download a client_credentials.zip file which you should unzip into
`<EXAMPLE_ROOT>/security`.  This is where the Java sample will look for truststore
and keystore JKS files.

To download, you'll need to provide a password for your JKS files.  Remember
the password as you'll need it to run the sample!  

**NOTE:** ACCS limits the use of special characters in environment variable
values but EECS requires you to use special characters in the JKS password.
Use "!" as your special character to avoid compatibility issues.


Compiling the Sample
====================

This app depends on the updated ojdbc7.jar and ucp.jar you downloaded in the
previous section.  For the Maven build to succeed `make.sh` installs them into
your local Maven repo.  You *MUST* run `make.sh` to install the dependencies and
build the sample (at least once).

Once you've run `make.sh` you can just use `mvn clean package` to build the
application archive.

Running the Sample locally
==========================

1. To run this sample, you'll also need to upgrade your JDK policy jars with the
unlimited strength policy jars you downloaded previously and placed into
`<EXAMPLE_ROOT>/policy_jars`.  To do this, run `<EXAMPLE_ROOT>/replace_policy_jar.sh $JAVA_HOME` as a
 user with the necessary permissions.  Likely you'll need to run the script
 using `sudo` on Linux or OSX.

2. You can launch the sample locally by calling `<EXAMPLE_ROOT>/local_start.sh <db user>
<db password> <trust and key store password>`.  The first two arguments must be
a user id/password combination valid for your EECS database.  The third argument
is the password you provided when you generated your EECS trust and keystore
files.

3. Once running, open <http://localhost:8080> to check to see if the app is
running.

4. Open <http://localhost:8080/date> to cause the sample to connect to your
EECS database and select the system date which will be displayed.

Running the Sample on ACCS
==========================

1. Create a new Java 8 application on ACCS and upload the application archive
that was generated by the Maven build.  The file is
`<EXAMPLE_ROOT>/target/exadata-express-test-0.0.1-SNAPSHOT-dist.zip`.

2. Once the application is created, go the the Deployment tab and define three
environment variables for the db user, db password, and JKS password and apply.
This will restart the Sample application.

  Define:

  * JKS_PASSWORD
  * EECS_USER
  * EECS_PASSWORD

3. Open the application URL and the status of the sample will be displayed.  If
you failed to define the EECS user and password variables you'll see an error
message displayed.  

4. If the sample is properly configured navigate to `http://<APP URL>/date` to
connect to the database and select the system date. If any of the db user,
db password, or store passwords are incorrect you'll get at 500 error (better
error handling in a future revision of the sample).

ACCS Deployment Technical Details
=================================

The ACCS `manifest.json` start command invokes `sh start.sh`.  The start script
simply sequences the invocation of `replace_policy_jars.sh` and the launch of
Java with the appropriate arguments necessary to enable secure communication to
EECS.

The archive should contain:

    manifest.json       
    start.sh  
    replace_policy_jars.sh
    security/keystore.jks  
    security/tnsnames.ora  
    security/truststore.jks          
    policy_jars/local_policy.jar  
    policy_jars/US_export_policy.jar       
    exadata-express-test-0.0.1-SNAPSHOT-jar-with-dependencies.jar

The application jar is a "fat" jar that contains the application code along with
all its dependencies, including the updated ojdbc7 and ucp classes.  
